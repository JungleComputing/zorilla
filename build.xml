<project name="Zorilla" default="build" basedir=".">
    <description>
        Build file for Zorilla
    </description>

    <!-- set a version stamp -->
    <tstamp>
        <format property="VERSION" pattern="yyyyMMdd-HHmm-ss"/>
    </tstamp>
	
    <target name="build" description="build everything">
        <ant dir="bamboo" />
        <ant dir="zoni"/>
        <ant dir="node"/>
        <ant dir="apps"/>
    </target>

    <target name="clean" description="clean everything">
        <ant dir="bamboo" target="clean"/>
        <ant dir="zoni" target="clean"/>
        <ant dir="node" target="clean"/>
        <ant dir="apps" target="clean"/>
    	
    	<delete dir="dist" />
    </target>
	
    <target name="javadoc" description="create javadoc documentation">
        <ant dir="zoni" target="javadoc"/>
    </target>

    <target name="dist" 
        depends="build, javadoc" 
        description="create a binary distribution of zorilla">

        <zip destfile="zorilla-src.zip">
            <zipfileset dir="bamboo/src" prefix="zorilla-src/"/>
            <zipfileset dir="zoni/src" prefix="zorilla-src/"/>
            <zipfileset dir="node/src" prefix="zorilla-src/"/>
            <zipfileset dir="apps/src" prefix="zorilla-src/"/>
        </zip>
    	
    	<delete dir="dist"/>
    	<mkdir dir="dist" />
    	
        <tar destfile="dist/zorilla-${VERSION}.tar.gz" compression="gzip">
            <tarfileset dir="." prefix="zorilla-${VERSION}"
                includes="zorilla-src.zip, log4j.properties, README, worker.security.policy, */lib/**, */javadoc/**, bamboo/LICENSE"
                />
            <tarfileset dir="." prefix="zorilla-${VERSION}" mode="755"
                includes="bin/**"
                />
        </tar>

        <zip destfile="dist/zorilla-${VERSION}.zip">
            <zipfileset dir="." prefix="zorilla-${VERSION}"
                includes="zorilla-src.zip, log4j.properties, README, worker.security.policy, */lib/**, */javadoc/**, bamboo/LICENSE"
                />
            <zipfileset dir="." prefix="zorilla-${VERSION}" filemode="755"
                includes="bin/**"
                />
        </zip>

    </target>

    <target name="pub" depends="build" 
        description="put small zorilla.tar.gz (no javadoc) snapshot on website">
    	
    	  <tar destfile="zorilla-small.tar.gz" compression="gzip">
    	            <tarfileset dir="." prefix="zorilla"
    	                includes="log4j.properties, README, worker.security.policy, */lib/**"
    	                />
    	            <tarfileset dir="." prefix="zorilla" mode="755"
    	                includes="bin/**"
    	                />
    	        </tar>
    	
        <scp
            file="zorilla-small.tar.gz"
            remoteToFile="ndrost@flits.few.vu.nl:/home/ndrost/www/zorilla.tar.gz"
            passphrase=""
            keyfile="${user.home}/.ssh/id_dsa"
            verbose="true">
        </scp>
    	
    	<delete file="zorilla-small.tar.gz" />
    </target>

</project>
